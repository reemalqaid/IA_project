(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{g76r:function(e,i,n){"use strict";n.r(i);var t=n("J4zp"),a=n.n(t),s=n("6DbX"),o=n("WFi5"),r=n("lXSF"),c=n("CR3P"),u=n("bXk7"),l=n("C+Rg"),d=n("Udbe"),f=n("iY3B"),g=n("srra"),b=n("ITKh"),k={stateCallback:new b.a,changeCallback:new b.a},h={sdk:null,config:null,grantTimer:null,grantCheckDelay:5e3,cookiePrivilegesCheckName:"__osp_check",userIdDef:null,userSubscribedDef:null,loginInputValueDef:null,init:function(e){var i=this;e&&(i.config=e),i.config&&"https:"===window.location.protocol&&r.a.on(["loadTimeout"],(function(){i.initialize()}))},initialize:function(){var e=this;e.initSdk(),Object(l.a)(e.config.sdk_path),k.changeCallback.add((function(i){k.stateCallback.fire({status:i,disabled:!0,loading:!0}),e.grantTimer&&clearTimeout(e.grantTimer),e.grantTimer=setTimeout((function(){k.stateCallback.fire({status:!1,disabled:!0,loading:!1})}),e.grantCheckDelay),e.sdk.isPushNotificationsEnabled((function(n){!n&&i&&e.sdk.registerForPushNotifications(),e.sdk.setSubscription(i)}))}))},initSdk:function(){var e=this;window.OneSignal=window.OneSignal||[],window.OneSignal.push(["init",{appId:e.config.api_id,autoRegister:!1,notifyButton:{enable:!0,showCredit:!1,prenotify:!0,displayPredicate:function(){return e.oneSignalInitCallback(window.OneSignal)}},safari_web_id:e.config.safari_web_id}])},oneSignalInitCallback:function(e){var i=this;return i.sdk=e,i.userIdDef&&i.sdk.getUserId((function(e){i.userIdDef.resolve(e)})),i.userSubscribedDef&&i.sdk.isPushNotificationsEnabled((function(e){i.userSubscribedDef.resolve(e)})),i.config.customer_email&&i.sdk.sendTag("group","customer"),i.sdk.isPushNotificationsEnabled((function(e){i.customControlChange(e),e?i.config.customer_email&&i.sdk.setEmail(i.config.customer_email):u.a.get(i.cookiePrivilegesCheckName)||i.sdk.getNotificationPermission((function(e){"default"===e&&(g.a.safari?i.sdk.showSlidedownPrompt():i.sdk.registerForPushNotifications())}))})),i.api=new d.a("push-notification"),i.sdk.on("subscriptionChange",(function(e){i.customControlChange(e),e&&i.config.customer_email&&i.sdk.setEmail(i.config.customer_email),i.config.customer_email&&i.sdk.getUserId((function(n){n&&i.api.update(n,{status:e})}))})),i.sdk.on("notificationPermissionChange",(function(e){i.grantTimer&&clearTimeout(i.grantTimer),"granted"===e.to?(i.sdk.setSubscription(!0),k.stateCallback.fire({status:!0,disabled:!1,loading:!1})):k.stateCallback.fire({status:!1,loading:!1,disabled:!0});var n=new Date;u.a.set(i.cookiePrivilegesCheckName,1,new Date(n.getTime()+2592e6))})),i.getUserId().then((function(e){e&&(window._taq=window._taq||[],window._taq.push(["setPushNotificationDeviceId",e]))})),!1},customControlChange:function(e){var i=this;i.sdk.getNotificationPermission((function(n){"denied"!==n&&(i.grantTimer&&clearTimeout(i.grantTimer),k.stateCallback.fire({disabled:!1,loading:!1,status:e}))}))},getUserId:function(){var e=this;return e.userIdDef||(e.userIdDef=new f.a,e.sdk&&e.sdk.getUserId((function(i){e.userIdDef.resolve(i)}))),e.userIdDef.promise()},isUserSubscribed:function(){var e=this;return e.userSubscribedDef||(e.userSubscribedDef=new f.a,e.sdk&&e.sdk.isPushNotificationsEnabled((function(i){e.userSubscribedDef.resolve(i)}))),e.userSubscribedDef.promise()},getOneSignalLoginInputValue:function(){var e=this;return e.loginInputValueDef||(e.loginInputValueDef=new f.a,e.getUserId().then((function(i){i?e.isUserSubscribed().then((function(n){n?e.loginInputValueDef.resolve(i):e.loginInputValueDef.resolve("")})):e.loginInputValueDef.resolve("")}))),e.loginInputValueDef.promise()}};Object(s.a)("PushNotificationConfig",(function(e,i){var n=i;if(!n)throw new Error("Undefined config");if(!n.api_id||!n.safari_web_id||!n.sdk_path)throw new Error("Invalid config. ".concat(JSON.stringify(n)));Promise.all([Object(o.a)(),Object(c.a)(n)]).then((function(e){var i=a()(e,1)[0];!0===i.isLoggedIn&&i.email&&(n.customer_email=i.email),h.init(n),r.a.trigger("onesignalInited",h)}))}));var m=n("7fUO");Object(s.a)("pushNotificationsBlock",(function(e){var i=e[0],n=i.querySelector("input[type=checkbox]");k.stateCallback.add((function(e){Object(m.C)(i,"disabled",e.disabled),Object(m.C)(i,"loading",e.loading),Object(m.C)(i,"checked",e.status),n.checked=e.status,n.disabled=e.disabled})),n.addEventListener("change",(function(e){k.changeCallback.fire(e.target.checked)}))}))}}]);